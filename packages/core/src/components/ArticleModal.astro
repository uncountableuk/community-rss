---
/**
 * ArticleModal component — full article display in a modal overlay.
 *
 * Supports deep linking via pushState, next/previous navigation,
 * and close via button or overlay click.
 *
 * @since 0.2.0
 */

interface Props {
  id: string;
  title: string;
  content?: string;
  authorName?: string;
  publishedAt?: Date;
  originalLink?: string;
  feedTitle?: string;
  /** Configurable label strings. @since 0.4.0 */
  labels?: {
    close?: string;
    next?: string;
    previous?: string;
    readOriginal?: string;
  };
}

const {
  id,
  title,
  content = '',
  authorName = 'Unknown',
  publishedAt,
  originalLink,
  feedTitle,
  labels: {
    close: closeLabel = 'Close article',
    next: nextLabel = 'Next →',
    previous: previousLabel = '← Previous',
    readOriginal: readOriginalLabel = 'Read original article →',
  } = {},
} = Astro.props;

const formattedDate = publishedAt
  ? new Date(publishedAt).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    })
  : '';
---

<div
  class="crss-modal-overlay"
  id="article-modal"
  data-article-id={id}
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title"
>
  <div class="crss-modal">
    <header class="crss-modal__header">
      <div class="crss-modal__meta">
        {feedTitle && <span class="crss-modal__source">{feedTitle}</span>}
        {formattedDate && <time class="crss-modal__date">{formattedDate}</time>}
        <span class="crss-modal__author">by {authorName}</span>
      </div>
      <button class="crss-modal__close" aria-label={closeLabel} data-modal-close>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          ><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"
          ></line></svg
        >
      </button>
    </header>

    <h1 class="crss-modal__title" id="modal-title">{title}</h1>

    <div class="crss-modal__content" set:html={content} />

    <footer class="crss-modal__footer">
      {
        originalLink && (
          <a
            href={originalLink}
            class="crss-modal__original-link"
            target="_blank"
            rel="noopener noreferrer"
          >
            {readOriginalLabel}
          </a>
        )
      }
      <nav class="crss-modal__nav" aria-label="Article navigation">
        <button class="crss-modal__nav-btn" data-modal-prev aria-label={previousLabel}
          >{previousLabel}</button
        >
        <button class="crss-modal__nav-btn" data-modal-next aria-label={nextLabel}
          >{nextLabel}</button
        >
      </nav>
    </footer>
  </div>
</div>

<style is:global>
  @layer crss-components {
    .crss-modal-overlay {
      position: fixed;
      inset: 0;
      background: var(--crss-comp-modal-overlay-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: var(--crss-sys-space-md);
      backdrop-filter: blur(4px);
    }

    .crss-modal {
      background: var(--crss-comp-modal-bg);
      border-radius: var(--crss-comp-modal-radius);
      max-width: var(--crss-comp-modal-max-width);
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: var(--crss-comp-modal-padding);
      box-shadow: var(--crss-comp-modal-shadow);
      position: relative;
    }

    .crss-modal__header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--crss-sys-space-md);
    }

    .crss-modal__meta {
      display: flex;
      flex-wrap: wrap;
      gap: var(--crss-sys-space-sm);
      font-size: var(--crss-comp-modal-meta-size);
      color: var(--crss-sys-color-text-muted);
    }

    .crss-modal__source {
      font-weight: 600;
      color: var(--crss-sys-color-primary);
    }

    .crss-modal__close {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--crss-sys-color-text-muted);
      padding: var(--crss-sys-space-xs);
      border-radius: var(--crss-sys-radius-sm);
      transition:
        color var(--crss-sys-transition-fast),
        background var(--crss-sys-transition-fast);
      flex-shrink: 0;
    }

    .crss-modal__close:hover {
      color: var(--crss-sys-color-text-primary);
      background: var(--crss-sys-color-surface-1);
    }

    .crss-modal__title {
      font-size: var(--crss-comp-modal-title-size);
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: var(--crss-sys-space-lg);
      color: var(--crss-sys-color-text-primary);
    }

    .crss-modal__content {
      line-height: 1.7;
      font-size: var(--crss-sys-font-size-base);
      color: var(--crss-sys-color-text-secondary);
    }

    .crss-modal__content img {
      max-width: 100%;
      height: auto;
      border-radius: var(--crss-sys-radius-sm);
      margin: var(--crss-sys-space-md) 0;
    }

    .crss-modal__content a {
      color: var(--crss-sys-color-primary);
      text-decoration: underline;
    }

    .crss-modal__content pre {
      background: var(--crss-sys-color-surface-1);
      padding: var(--crss-sys-space-md);
      border-radius: var(--crss-sys-radius-sm);
      overflow-x: auto;
      font-family: var(--crss-sys-font-family-mono);
      font-size: var(--crss-sys-font-size-sm);
    }

    .crss-modal__content blockquote {
      border-left: 3px solid var(--crss-sys-color-primary);
      padding-left: var(--crss-sys-space-md);
      margin: var(--crss-sys-space-md) 0;
      color: var(--crss-sys-color-text-muted);
      font-style: italic;
    }

    .crss-modal__footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: var(--crss-sys-space-xl);
      padding-top: var(--crss-sys-space-md);
      border-top: 1px solid var(--crss-sys-color-surface-2);
      flex-wrap: wrap;
      gap: var(--crss-sys-space-md);
    }

    .crss-modal__original-link {
      color: var(--crss-sys-color-primary);
      text-decoration: none;
      font-size: var(--crss-sys-font-size-sm);
      font-weight: 500;
    }

    .crss-modal__original-link:hover {
      text-decoration: underline;
    }

    .crss-modal__nav {
      display: flex;
      gap: var(--crss-sys-space-sm);
    }

    .crss-modal__nav-btn {
      background: var(--crss-sys-color-surface-1);
      border: 1px solid var(--crss-sys-color-surface-2);
      border-radius: var(--crss-sys-radius-sm);
      padding: var(--crss-sys-space-xs) var(--crss-sys-space-md);
      font-family: var(--crss-sys-font-family);
      font-size: var(--crss-sys-font-size-sm);
      color: var(--crss-sys-color-text-secondary);
      cursor: pointer;
      transition:
        background var(--crss-sys-transition-fast),
        color var(--crss-sys-transition-fast);
    }

    .crss-modal__nav-btn:hover {
      background: var(--crss-sys-color-surface-2);
      color: var(--crss-sys-color-text-primary);
    }
  }
</style>
