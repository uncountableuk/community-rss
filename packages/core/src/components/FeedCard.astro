---
/**
 * FeedCard component â€” displays a single article in the feed grid.
 *
 * Shows title, source, date, summary, and interaction count stubs.
 * All visual values use CSS custom properties for theming.
 *
 * @since 0.2.0
 */

interface Props {
  id: string;
  title: string;
  summary?: string;
  authorName?: string;
  publishedAt?: Date;
  originalLink?: string;
  feedTitle?: string;
  heartCount?: number;
  starCount?: number;
  /** Configurable label strings. @since 0.4.0 */
  labels?: {
    hearts?: string;
    stars?: string;
  };
}

const {
  id,
  title,
  summary,
  authorName = 'Unknown',
  publishedAt,
  originalLink,
  feedTitle,
  heartCount = 0,
  starCount = 0,
  labels: {
    hearts: heartsLabel = 'Hearts',
    stars: starsLabel = 'Stars',
  } = {},
} = Astro.props;

const formattedDate = publishedAt
  ? new Date(publishedAt).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
    })
  : '';
---

<article class="crss-feed-card" data-article-id={id}>
  <a href={`/article/${id}`} class="crss-feed-card__link" data-article-link>
    <header class="crss-feed-card__header">
      {feedTitle && <span class="crss-feed-card__source">{feedTitle}</span>}
      {formattedDate && <time class="crss-feed-card__date" datetime={publishedAt?.toISOString()}>{formattedDate}</time>}
    </header>

    <h3 class="crss-feed-card__title">{title}</h3>

    {summary && <p class="crss-feed-card__summary">{summary}</p>}

    <footer class="crss-feed-card__footer">
      <span class="crss-feed-card__author">{authorName}</span>
      <div class="crss-feed-card__interactions">
        <span class="crss-feed-card__hearts" title={heartsLabel}>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
          <span>{heartCount}</span>
        </span>
        <span class="crss-feed-card__stars" title={starsLabel}>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
          <span>{starCount}</span>
        </span>
      </div>
    </footer>
  </a>
</article>

<style>
  .crss-feed-card {
    background: var(--crss-surface-0);
    border: 1px solid var(--crss-surface-2);
    border-radius: var(--crss-radius-md);
    overflow: hidden;
    transition: box-shadow var(--crss-transition-fast, 0.15s) ease,
      transform var(--crss-transition-fast, 0.15s) ease;
  }

  .crss-feed-card:hover {
    box-shadow: var(--crss-comp-card-hover-shadow);
    transform: translateY(var(--crss-comp-card-hover-lift, -2px));
  }

  .crss-feed-card__link {
    display: block;
    padding: var(--crss-space-md);
    text-decoration: none;
    color: inherit;
  }

  .crss-feed-card__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--crss-space-sm);
    font-size: var(--crss-font-size-xs);
    color: var(--crss-text-muted);
  }

  .crss-feed-card__source {
    font-weight: 600;
    color: var(--crss-brand-primary);
  }

  .crss-feed-card__title {
    font-size: var(--crss-font-size-lg);
    font-weight: 600;
    line-height: 1.3;
    margin-bottom: var(--crss-space-sm);
    color: var(--crss-text-primary);
  }

  .crss-feed-card__summary {
    font-size: var(--crss-font-size-sm);
    color: var(--crss-text-secondary);
    line-height: 1.5;
    margin-bottom: var(--crss-space-md);
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .crss-feed-card__footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: var(--crss-font-size-xs);
    color: var(--crss-text-muted);
  }

  .crss-feed-card__interactions {
    display: flex;
    gap: var(--crss-space-sm);
  }

  .crss-feed-card__hearts,
  .crss-feed-card__stars {
    display: flex;
    align-items: center;
    gap: var(--crss-space-xs);
  }

  .crss-feed-card__hearts svg {
    color: var(--crss-heart);
  }

  .crss-feed-card__stars svg {
    color: var(--crss-star);
  }

  /* Styles for dynamically-created feed cards (via infinite scroll) */
  :global(.crss-feed-card) {
    background: var(--crss-surface-0);
    border: 1px solid var(--crss-surface-2);
    border-radius: var(--crss-radius-md);
    overflow: hidden;
    transition: box-shadow var(--crss-transition-fast, 0.15s) ease,
      transform var(--crss-transition-fast, 0.15s) ease;
  }

  :global(.crss-feed-card:hover) {
    box-shadow: var(--crss-comp-card-hover-shadow);
    transform: translateY(var(--crss-comp-card-hover-lift, -2px));
  }

  :global(.crss-feed-card__link) {
    display: block;
    padding: var(--crss-space-md);
    text-decoration: none;
    color: inherit;
  }

  :global(.crss-feed-card__header) {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--crss-space-sm);
    font-size: var(--crss-font-size-xs);
    color: var(--crss-text-muted);
  }

  :global(.crss-feed-card__source) {
    font-weight: 600;
    color: var(--crss-brand-primary);
  }

  :global(.crss-feed-card__title) {
    font-size: var(--crss-font-size-lg);
    font-weight: 600;
    line-height: 1.3;
    margin-bottom: var(--crss-space-sm);
    color: var(--crss-text-primary);
  }

  :global(.crss-feed-card__summary) {
    font-size: var(--crss-font-size-sm);
    color: var(--crss-text-secondary);
    line-height: 1.5;
    margin-bottom: var(--crss-space-md);
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  :global(.crss-feed-card__footer) {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: var(--crss-font-size-xs);
    color: var(--crss-text-muted);
  }

  :global(.crss-feed-card__interactions) {
    display: flex;
    gap: var(--crss-space-sm);
  }

  :global(.crss-feed-card__hearts),
  :global(.crss-feed-card__stars) {
    display: flex;
    align-items: center;
    gap: var(--crss-space-xs);
  }

  :global(.crss-feed-card__hearts svg) {
    color: var(--crss-heart);
  }

  :global(.crss-feed-card__stars svg) {
    color: var(--crss-star);
  }
</style>
